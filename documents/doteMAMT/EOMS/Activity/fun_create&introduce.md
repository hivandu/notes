---
date: 2020-08-18
author: Hivan
---

# 活动创建和规则引入

|日期|修订人|内容|
|---|---|---|
|20200916|@dubin|增加了附录中关于活动生效的具体定义，修订具体内容可参看Gitlab上|

## 概述

为了便于之后对门店的权限下放和流程管控，活动创建和规则创建是分离的。规则创建之后可以被活动所引入。活动创建流程及规则引入如下：

## 活动类型

进入活动管理后，根据活动类型不同会分成3个标签进行切换，分别为：

1. 充值活动
2. 上网活动
3. 销售活动

![](http://qiniu.hivan.me/mweb/2020-08/15977442880882.jpg)

切换到任意一个标签，都会进入相应的活动类型列表;

## 上网活动创建

当点击列表页上方的**新建活动**则会创建对应的活动：

![](http://qiniu.hivan.me/mweb/2020-08/15980014020383.jpg)

上网活动创建展示如图：

![](http://qiniu.hivan.me/mweb/2020-08/15983220868355.jpg)

### 活动基础信息

活动基础信息属于活动通用设置，可参看[活动基础信息](./fun_general.md#活动基础信息)

### 活动配置

活动配置每个活动类型都不一样，在上网活动的活动配置内，包含以下几个配置项：
1. [区域](#区域)
2. [优先级](#优先级)
3. [规则选择](#规则选择)（仅可选择上网规则）
4. [活动门店](#活动门店)

#### 区域

![-w941](http://qiniu.hivan.me/mweb/2020-08/15983288090135.jpg)

区域设置上, 配置页面上默认将全门店所有区域都做展示, 也可进行全部勾选.
在具体上网时触发, 直接以设定的区域列表做判断

比如:

1. 设定上勾选了某个区域, 但是门店实际没有这个区域, 则不作为判断依据
2. 如果设定上未勾选某个区域, 但是门店实际有这个区域, 则活动不触发

#### 优先级

![-w760](http://qiniu.hivan.me/mweb/2020-08/15983288226656.jpg)

1. 优先级分为: 低, 中, 高 三种权限, 权重依次提高;
2. 当同为总部活动, 且同为一个优先级时,以创建时间为依据判断, 创建时间越靠后的, 权重最大.

优先级影响活动的触发，关于活动触发规则，详见[活动的创建和生效依据](#活动的创建和生效依据)

#### 规则选择

![-w581](http://qiniu.hivan.me/mweb/2020-08/15983292021929.jpg)

规则选择会根据当前活动分类（上网、充值、销售）会调用不同的活动规则列表

规则选择模块会有两种状态：

1. 未引入规则状态

    ![](http://qiniu.hivan.me/mweb/2020-08/15983292157598.jpg)
2. 已引入规则状态

    ![](http://qiniu.hivan.me/mweb/2020-08/15983292244950.jpg)
    
当选取并引入了规则，已引入的规则可以更换。引入规则会以卡片形式展现相关信息。关于规则卡片的具体展示可参照规则模块内的[规则预览](./rule#规则预览)

#### 活动门店

:::warning
活动门店是从原来的活动基础信息中重新归纳到了活动配置，原因是活动的可参与门店受到了规则可见门店的限制
:::

此处设置活动门店有两种状态：
1. 不可编辑
2. 可编辑

当创建的活动还未引入规则的时候，无法编辑活动门店；

![-w847](http://qiniu.hivan.me/mweb/2020-08/15983351344599.jpg)


当创建的活动引入了一个规则之后，活动的规则受到规则可见门店的限制，活动的可参与门店==不能超过引入规则中可见门店的最大范围==；

![-w861](http://qiniu.hivan.me/mweb/2020-08/15983351614178.jpg)

引入规则后，默认先将规则内的可见门店全部导入活动内的活动门店设置内，且活动的可参与门店职能在此基础上进行删减，无法再添加其他门店。

### 活动限制

活动限制属于活动通用设置，详情可参见[活动限制](./fun_general#活动限制)

## 充值活动创建

:::tip
**占位**
:::

## 销售活动创建

:::tip
**占位**
:::

## 活动规则引入

### 引入动作

默认新建活动的时候在[活动配置](#活动配置)内可以进行[规则选择](#规则选择)

当活动需要引入规则，点击“添加规则”, 进入[待引入规则列表](#待引入规则列表)进行选择

![](http://qiniu.hivan.me/mweb/2020-08/15977422492226.jpg)

### 待引入规则列表

![](http://qiniu.hivan.me/mweb/2020-08/15977421868207.jpg)

这个列表和之前的规则列表有所区别：
1. 此列表相关展示字段与规则列表不同
2. 此列表仅展示状态为启用的规则
3. 此列表仅可操作选取，不可做其他操作
4. 此列表的筛选条件较多，目的是为了精准定位待选取规则

:::warning
进入待引入规则列表时，如果活动时间已经设置，并且单次重复周期大于60天，则列表内==累积活动不可见==，并红色文字提示：“**由于活动单词周期大于60天，无法选择累积活动**”
:::

![](http://qiniu.hivan.me/mweb/2020-08/15983387295207.jpg)

选取规则需要进行过滤，详见[规则条件过滤](#条件过滤)

#### 条件过滤

在[待引入规则列表](#待引入规则列表)右上角，有筛选按键：

搜索条件包含：

1. 规则名称
2. 活动类型
3. 活动形式
4. 活动条件
5. 优惠重叠
6. 优惠类型
7. 券门店属性
8. 优惠金额
9. 优惠券规则
10. 可见门店

且最后可以对条件进行重置

##### 默认状态

初次点开筛选器，默认状态如图：

![](http://qiniu.hivan.me/mweb/2020-08/15983462111820.jpg)

##### 搜索规则名称

规则名称支持任意字符串的模糊搜索

##### 活动类型

多选项，可选择的活动类型包含：
1. 时长活动
2. 金额活动

![](http://qiniu.hivan.me/mweb/2020-08/15983467925741.jpg)

##### 活动形式

单选项，包含：
1. 单次
2. 累积

:::warning
如果活动时间已经设置，且单次周期是大于60天，则默认累积活动不可选
:::

![](http://qiniu.hivan.me/mweb/2020-08/15983463330317.jpg)

##### 活动条件

输入值，包含两个输入框：

1. 最小值
2. 最大值

:::tip
此处的值为去量纲，无单位值，可以是金额单位，也可以是时间单位。
也就是说，如果输入值为40 ~ 150, 有可能是40分钟 ~ 150分钟， 也可能是40元 ~ 150元，具体过滤需要看活动类型过滤
:::

![](http://qiniu.hivan.me/mweb/2020-08/15983471257700.jpg)

##### 优惠重叠

多选项，包含：
1. 鱼乐卡折扣
2. 上网券
3. 包时段
4. 免单
5. 时长券

选择的过滤项则需要过滤出此项在设置规则时被勾选的规则；

**优惠重叠过滤条件补充：**

由于在创建规则和进行筛选的时候，都是多选项。所以这里需要对过滤条件进行一个补充说明：

多选条件中的任意一个条件都视为单独条件，将会过滤出其条件相关的规则，如图：

![](http://qiniu.hivan.me/mweb/2020-08/15984283711535.jpg)

当前创建了三个规则，分别包含优惠重叠规则为：

1. 规则1: 鱼乐卡、上网券
2. 规则2: 鱼乐卡、时长券
3. 规则3: 包时段、时长券

这时候输入过滤条件： 鱼乐卡、包时段

多个过滤条件单独作用，不相互作用，所以此时三个规则都会被过滤出来；



##### 优惠类型

多选项，包含：

1. 券
2. 券包
3. 赠送金

##### 券门店属性

单选项, 包含：
1. 单店
2. 全门店

##### 优惠金额

输入值，包含两个输入框：

1. 最小值
2. 最大值

##### 优惠券规则

输入值， 只包含一个输入框，用于输入券规则编码。

**未填入**

![](http://qiniu.hivan.me/mweb/2020-08/15983480017372.jpg)


已填入：

![](http://qiniu.hivan.me/mweb/2020-08/15983480111944.jpg)


##### 可见门店

此模块为填入值，点击后进入门店树形结构查找框：

![](http://qiniu.hivan.me/mweb/2020-08/15983480748185.jpg)

当在此处填入某个区域或者门店后，填入值为过滤条件。

此处填写过滤条件的之后，==以树形结构向上索引，不向下索引==。

比如：1084为上海二区门店，当选择上海二区作为过滤条件的时候，单独设置1084可见的规则这里将不过滤出来，而如果输入1084作为过滤条件的时候，设置为上海二区可见的规则会被过滤出来。

##### 重置条件

点击**重置条件**，则以上所有条件将被重置，如果活动形式中累积不可选，则此条件不重置。还是依赖于活动中已经设置的活动时间。

#### 选取动作

过滤出相应的规则之后，直接点击列表内某一个规则的**选取**按钮，则可以将规则直接引入活动内。如[规则引入](./fun_general.md#规则引入)

![选取动作](http://qiniu.hivan.me/mweb/2020-08/15983504479825.jpg)

### 引入限制

创建一个活动在引入规则以后，规则会影响活动的两个设置项：
1. 活动周期
2. 可参与门店

#### 活动周期

如果引入的规则是累积形式规则，则此活动在设置活动周期的时候无法设置单次周期大于60天的活动，表现为：
1. 当未设置可重复，但是整体活动周期设置大于60天，则此活动无法保存；
2. 设置了可重复，按年重复，则周期选择上控制不能选取大于60天；

#### 可参与门店

门店引入规则之后，根据规则的可见门店限制可参与门店，即活动的可引入门店范围必须小于等于规则的可见门店范围。


## 附录

### 活动的创建和生效依据

1. 以门店维度只允许存在一个生效活动
2. 以总部维度可以存在多个生效活动
3. 创建活动时不再判断时间重叠关系,也就是可以创建多个同一时间段内的有效活动.
4. 如果同一时间段内满足两个或以上的活动, 生效时需要判断权重依据

    - 总部活动的权限大于门店活动;
    - 优先级分为: 低, 中, 高 三种权限, 权重依次提高;
    - 当同为总部活动,且同为一个优先级时, 以创建时间为依据判断, 创建时间越靠后的, 权重最大.

5. 在时间重叠性判断上，以实际活动生效的具体时间为准，判断依据精确到天
  
    > **示例**：
    
    > ![](http://qiniu.hivan.me/mweb/2020-09/16002283756276.jpg)
    
    > 1. 总部和门店分别创建了两个活动，两个活动整体活动周期都为两个月，
    > 2. 总部的活动设置了按周循环，每周6,7; 
    > 3. 门店设置了周循环，每周1~6;
    > 4. 周6两个活动冲突，权重较大的活动生效，**此时应该是总部活动生效**；
    > 5. 也就是说，实际的生效活动是用户在结帐下机的时候去查找当前有哪些活动处于有效状态，再根据当前有效的活动去判断权重；而活动是否处于有效状态的判断是依据重复日期而不是整个活动周期；
    
    > **表格**:
    
    > | 活动             | **周一** | **周二** | **周三** | **周四** | **周五** | **周六** | **周日** |
    > | ---------------- | -------- | -------- | -------- | -------- | -------- | -------- | :------- |
    > | **总部创建活动** | 无活动   | 无活动   | 无活动   | 无活动   | 无活动   | 有活动   | 有活动   |
    > | **门店创建活动** | 有活动   | 有活动   | 有活动   | 有活动   | 有活动   | 有活动   | 无活动   |
    > | **生效活动**     | 门店活动 | 门店活动 | 门店活动 | 门店活动 | 门店活动 | 总部活动 | 总部活动 |
6. 用户跨天结帐：用户如果出现跨天结帐，以上面示例为准进行说明，用户在周五的时候上网并且持续到周六结帐下机，此时判断依据为周六的有效活动;
7. 关于累积规则：累积规则的活动基础判断一样依赖于第五条时间重叠性判断规则，注意点在于，同一段上网时长只能应用于一个活动，当天生效的一次性活动权限较大，则同一时间段内的累积规则的上网时长不进行累积；

    > **示例：**

    > ![](http://qiniu.hivan.me/mweb/2020-09/16002294482803.jpg)
