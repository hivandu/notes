# 实现采购入库

采购入库主要通过采购系统和仓库管理系统进行交互来实现。先来看看采购系统和仓库管理系统的整体产品设计思路，对系统和概念先有宏观的认识和了解。

## 采购系统

采购系统主要操作所有向供应商进行采购的相关事项，它管理着商品从供应商到仓库之间的所有业务行为。现在的采购管理更多的是向精细化、智能化发展。

​	

采购系统的核心价值在于将货品的所有权经过合理的流程进行转移和交接。在货品所有权的转移和交接过程中，线下是实体货品的转移和运输，而线上是采购SKU（StockKeeping Uint，库存量单位）的数据流转以及货款金额的流转，因此采购系统管理的主体流程包括SKU货品采购流程及账款资金流流程。



流程的参与角色主要包括供应商、仓库及采购人员，当然在账款结算时还需要和财务打交道。连接不同角色的除了单据流程，还有一些实体的信息。例如，合同是连接采购和供应商的实体信息，发票是连接供应商、采购和财务的实体信息。



将与采购相关的信息和实体组合起来，形成采购系统需要管理的内容：

![image-20210227122206363](http://qiniu.hivan.me/picGo/20210227125825.png)



可以看到，上述的流转包括商品流转和账款流转。其中，商品流转是指供应商与仓库属于供给双方，采购负责根据仓库和商品需求签约供应商，并根据仓库库存提交采购计划。商品计划通过采购提交给供应商后由供应商完成配送，同时也对仓库退货进行管理。在整个过程中会产生采购流程和退货流程，参与的角色包括供应商、采购和仓库。账款流转主要指财务根据账期对供应商进行结款，结算主要依存于双方对结算单的确认核对，财务按照确认后的结算单的账单金额进行支付。



总结下来，采购的业务流程主要有3个：采购流程、退货流程和财务结算。支撑这些流程流转的基础数据是所有单据的信息来源，包括合同、商品和仓库信息等。



按照上面讲的基础数据、采购、退货和财务结算4个部分，我们来看一下每个部分都有哪些需要注意的内容。



### 基础数据

采购系统的基础数据维护主要是维护采购过程中出现的实体，如商品、供应商和采购人员等。这里面供应商管理又属于相对比较复杂的部分，可以单独作为一个系统运行。下面分别讲述各部分需要关注的要点。



商品信息主要管理商品最基本的内容，如商品名称、商品编码（用于在单据内人工快速识别商品的标识）和仓储等。




| 信息项       | 字段内容（包括但不限于）         |
| :----------- | :------------------------------- |
| 商品基础信息 | 商品名称、商品编码、分类、供应商 |
| 价格信息     | 进价                             |
| 仓储信息     | 长、宽、高、箱规、重量、仓储参数 |



合同管理是采购系统中比较核心的数据，所有采购单的下发和结算都应该依据合同进行，超出合同范围的内容是不允许进行的。合同关联着采购人员、供应商、采购单和仓库。



合同的类型也有很多种，如经销合同、代销合同等，每种类型合同的信息和处理方法都是不同的。比较常见的是经销合同，就是我们常说的进货。供应商将货品按照合同约定的条款完成出货，并将货品送至购买方的仓库。在经销合同中，主要信息条款包括合同甲乙双方信息、合同条款明细、结款信息、进退货信息及合同有效期。

* 甲乙双方信息：双方公司名称，甲方需要详细到部门，乙方（即供应商）需要提供资质信息。
* 合同条款明细：用来描述合同的具体内容。由于是采购合同，因此条款中同样包括供应商提供采购的商品明细清单，该清单在后续流程中用于生成商品信息。
* 结款信息：合同结款的具体付款周期、税率、合同折扣和返点信息等。
* 进退货信息：进货、退货的相关信息规则，如进货周期、退货周期、退货比例和到货周期等。
* 合同有效期：规定合同生效的起止时间，有效期内所有采购按照合同明细规则进行处理。



合同管理的另一方面就是审批和变更、作废。所有建立的合同都需要经过合同的审批过程，未审批的合同不允许自动生效。合同的审核内容主要是审核资质情况及合同明细条款，而执行过程中出现合同变化则需要执行合同变更流程。合同到期结束或者提前终止则需要进行合同作废，作废后的合同所涉及的供应商商品则不再可以进行采购。



关于合同、采购认购单以及合同与采购单的关系，这里要说明一下。采购认购单是代表采购人员期望采购的商品情况，根据认购单去和供应商谈判，完成供应商合同的签订。签订后，认购单的商品采购清单就会转化成合同里面的商品明细条款。采购补充完其他条款后，完成合同录入的工作。根据合同来生成采购单并完成采购的配送和入库工作。



### 采购管理

采购管理是用来监管所有采购行为的体系。前面描述了采购过程中的行为，通常是签订合同以后，由供应商完成商品录入，采购人员根据仓库情况下采购单，采购单分发给对应的供应商确认，供应商确认后，根据采购单中的商品列表备货、发货和验收入库。



这是个基础的流程，不作太多的说明，需要了解一下在这个过程中业务的一些逻辑分支和业务概念。采购的流转是通过单据来进行的，首先我们先了解几个单据的概念。



- 询价计划单：采购根据采购情况发送单据，向供应商询价，询价单主要记录供应商情况、商品清单和所需商品数量。
- 报价单：根据采购提供的询价计划单，反馈生成报价单，报价单记录所有供应商的报价信息和可以提供的产量。
- 采购申请单：采购根据库存和售卖的情况填写请购单，审批通过的所有请购单按照一定的归类（如供应商、仓库等）生成对应的采购计划。
- 采购单：采购单是形成采购行为的唯一单据凭证，通过采购单的流转来完成采购过程的跟进监管。
- 采购运单：计划采购的商品单据，可以包含多个部门或者供应商的采购需求；采购计划审批通过后，会按照归类情况自动生成采购单，并分发给对应的供应商；采购计划是采购单的组合，其目的是方便进行统一的安排管理。
- 采购入库单：采购入库单用于入库时仓库接收使用，它主要用于核对采购批次的商品情况。



不同类型的单据对应在不同的节点使用，业务流程的衔接实际是单据的衔接。



采购单是采购流程的核心单据，由采购单构成的计划集合叫作采购计划。采购单或者采购计划生成前会经过询价、报价和比价的过程，生成后的采购单会按照批次同步仓库进行运输配送，仓库根据收到的采购商品信息和到货时间安排入库行为，同时生成入库单。采购商品到仓后，会根据采购运单和采购入库单对其进行核对，核对无误进行签收，完成本次采购的全过程。

![image-20210227122403891](http://qiniu.hivan.me/picGo/20210227122403.png)



供应商收到采购单后，可能会回告发货数量和进折/进价。



若回告，则以供货商的回告数据作为“到货率”等采购员绩效考核的依据和到货关联的依据；若不回告，则以采购单上的采购数据作为考核依据。若合同内有预付款的采购单，则必须回告，只有回告后系统才可以自动生成预付款。



在采购流程中，系统设计需要关注几个环节。首先是采购申请的创建，原则上由采购人员人工完成采购申请的创建，但目前很多采购系统会根据销售订单的情况和仓库内的数据进行智能分析，对采购的商品进行销售预测和采购计划制订。



销售预测，顾名思义，是指将未来一段采购周期内的销售情况进行预估分析，从而判断商品所需的库存量情况。销售预测的算法模型同推荐、搜索和CRM等算法类似。



说一下销售预测的判断因子。对于销售量预估来说，有很多内在或外在的因素会影响它的变化，比如商品生命周期（是否新品、售卖时长）、促销事件（往期同时段是否有一些大促节点）、销售趋势变化和往期销量等，称之为判断因子。通常认为销售量会按照一定的周期不断重复自己，它的销售曲线会根据这些因子呈现相似的波动。而基于销售预估，结合仓库内的库存周转率，我们可以得出周期内需要采购的商品数量，这就是采购计划。在生成采购计划的时候，不能按照当前的仓库库存情况进行判断，而需要根据采购在途的时长累加来判断在对应的周期内是否可以满足。比如，当前仓库A中的商品a的仓库库存临界值为7天，而从采购发起到配送完成一般需要5天的时间，那么发起采购计划的时候就要按照7+5=12天的时间来计算库存是否满足，如果低于临界值，则需要提交采购计划或者提示采购人员创建采购计划。



采购计划创建前，需由采购人员按照标准流程完成前序的询价、比价等过程，采购人员提出采购申请以后，需要进行内部审批，审批通过的采购申请单会提交给相关供应商进行询价。不过大多数时候，会通过系统比较各家供应商在签订合同时候的价格或者价格规则自动完成询价、比价过程，因此在有些采购系统中这个环节会被忽略。一般的处理方式是设计一个专门的供应商价格模块，将有合同的供应商的SKU价格维护在这个模块中，每次创建采购单的时候自动从这个系统中完成价格的获取。



最后看一下采购履约的过程。一般来说，采购履约的目的地是平台的仓库，但实际的业务中也会有一些特殊的场景出现，比如厂家直送。厂家直送的场景是用户在平台下单完成后，订单会根据对应的供应商直接推送到供应商平台，供应商根据订单信息完成拣货、发货的过程。通常情况下，会在订单发货的同时生成一条采购单信息，用于匹配用户订单，这种采购单的履约不是配送到仓库，而是通过第三方快递发送到用户手中。当快递完成后，订单状态可以通过超时更新或者系统回传的方式完结用户订单。



采购配送履约如果交接到仓库，则在入库时需要进行双方货品的核对。采购履约的情况最终会以实际签收数量为准，仓库可以根据实际情况来完成全部签收、部分签收或者拒收的操作。如果确认签收，则需要完成纸质和系统的操作，签收后的流程见WMS的仓库管理。



需要注意的是，采购单中的商品规格是指入库时验收的规格，不代表实际的销售规格，如采购单的规格可能是“箱”，但是入库后上架售卖的规格可能是“个”。此外，再介绍一个名词“仓报价”，也就是我们通常说的仓库入仓时候的成本价，它有可能等于或者大于采购单中的采购价。

### 退货

退货特指从仓库将商品退还给供应商的行为。采购单因为某些原因未能入库一般叫作“拒收”而不属于退货的范围。退货时提交退货申请单，标注采购单号作为关联，退货申请单需要经过供应商审批确认后，方可由供应商安排车辆来仓库取货。

### 财务结算

供应商与平台之间的货款需要按周期结算。财务结算的流程比较简单，主要是财务根据入库和退货的单据生成结算单，将结算单提交给供应商进行确认，确认后进行开发票、打款等行为。



这里说一下从采购单转化为结算单的过程。进行周期结算时，会首先根据采购单和退货单生成对应的应付单收据，并回告供应商进行查看核对。应付单收据核对无误后，由采购人员提交申请付款，提交的单据叫作付款申请单。申请单经过采购部门各级领导和财务的审批，通过后自动转化为付款单，也叫作结算单。财务会根据结算单进行打款。

### 产品架构

采购系统在业内属于相对标准的系统模式，业务流程也比较成熟，因此，对于采购系统的产品架构图，我只画出相对主要的功能模块，其他的可以在实际业务中修改。也可以参照网鱼目前已有系统，比如：ERP系统。



采购业务的系统核心就是基础数据维护、单据管理及跟踪，还有审核流程。



按照主要的角色，系统拆分为供应商平台和采购系统两部分，从广义上来说它们都属于采购系统的范畴。



这里需要单独说一下协同的部分，这是进行AI智能及精细化管理的一些样例。智能补货这块业务功能主要是根据一些算法模型来进行采购计划的生成和推荐，具体的算法如果时间还允许，将会单独写一章《无人货架智能补货逻辑》，大体上是与之相同的。



EDI（ElectronicDataInterchange）叫作电子数据交换，简单地说就是通过对接一些大型企业的标准数据，来保证商品数据的及时更新。

![image-20210227124035734](http://qiniu.hivan.me/picGo/20210227125850.png)

## 仓库管理

仓库管理系统（Warehouse Management System，WMS）是通过入库业务、出库业务、仓库调拨、库存调拨和虚仓管理等功能，对批次管理、物料对应、库存盘点、质检管理、虚仓管理和即时库存管理等环节进行综合管理的系统，它有效控制并跟踪仓库业务的物流和成本管理全过程，实现或完善企业仓储信息管理。



WMS作为仓储系统，其职责就是维护管理好与仓库有关的所有物资和作业流程，维持仓库的平稳运营。在仓库内的所有工作都会形成一条动线，如何优化动线、提高人效是仓储系统的根本目的。WMS共有3个部分的操作流程，简单说就是入库操作、在库操作和出库操作。

![image-20210227124100578](http://qiniu.hivan.me/picGo/20210227124100.png)

### 仓库情况概述

在设计仓储系统前，需要先了解一下具体的仓库内部结构，明白仓库人员的工作内容。我们将仓库按照从大到小的管理单位划分，它的基础管理单位包括：仓库、大区、库区和货位（库位）。



仓库指的是单个存储货物并进行收发管理的场地。这里我们说的仓库实际上是狭义的仓库，在传统的工厂内，仓库既保存成品产品也保存生产原料，所有成品产品生产完毕后会通过配送中心进行进货、备货和发货的操作。配送中心（Distribution Center，DC）也就是这里特指的仓库。



每个仓库内部的作业流程都会形成一套完整的闭环，包括上述的入库、在库和出库。



电商的仓库，无论是平台本身自建还是第三方入住商户，一般都在1000平方米以上，从面积上来说，管理起来很不方便。为了能够管理到位，需要按照不同的陈列布局，将整个仓库切分为若干个大区，每个大区下又按照功能不同划分为不同的库区。



按照大区到库区的划分方式，可以有效地将仓库切割成若干个小区域，这个布局可以为拣货人员进行快速指引，同时也可以对仓库进行合理规划和管理。库区下最小的货品陈列区域则叫作库位或者货位，原则上每个货位只能陈列一种商品SKU，无数个货位组成一个完整的库区，库区内货位会根据货架的摆放情况构成一条条陈列架组成的通道。当拣货员拣货时，可以根据从大到小的定位，快速精确地找到每个货品的位置。



从整体结构来说，仓库的管理单位包括上述4个部分，而实际作业时，每一级会按照业务作业的实际功能需求有很多不同的类型。



仓库按照功用可以分为很多种，比较常见的是RDC、FDC及仓店。



RDC指区域分拨中心（Regional Distribution Center），也就是我们通常叫的“大仓”。RDC一般负责物流配送、分发，是区域范围内的主要仓储单位。



FDC属于RDC的二级仓库，FDC指前端分拨中心（Front Distribution Center），主要负责暂存货品，也可以看作转运中心。



而仓店则属于具备销售能力的仓库，大多用在零售行业，以前店后仓的形式存在，既具备店铺的功能又保留了仓库的属性。仓店这种形式在新零售领域也被叫作“前置仓”或者“门店”，它具备在小范围内进行发货履约的能力。



通常我们会将RDC定义为综合仓，储存相对较多品类的商品，而FDC则作为品类仓，放置周转率高、销售频率高的商品来满足库存需求。



综合仓可以作为品类仓的母仓，也叫“支援仓”，当品类仓无法全单满足的时候，可以通过对应区域范围内的母仓进行调拨，这种结构叫作“子母仓结构”，即上一级仓库可以作为下一级仓库的补充。如果相邻区域的仓库品类都相对较为丰富，只有在库存不足时考虑移仓调拨，这种仓间结构叫作“平行仓结构”。考虑成本因素，一般不做移仓行为，只有在区域范围内单量达到一定级别后，可以通过运输频次来抵消成本，才会进行较多移仓调拨。FDC和下一级的仓店也可以看做具备类似的仓间结构。



仓库内的库区也具备不同类型的划分。库区类型有两个维度：存储类型和功能类型。



存储类型指的是当前库区的功能划分，包括拣选区、暂存区、备货区和样品区等。



而功能类型将当前区域的具体作业功能情况划分出来，比如普通拣选品、打包暂存区和库内返架分播区等。



这两个属性决定库区的功能及作业职能。库区的划分目的是后续分配作业任务的时候可以根据库区类型自动分配。仓库内最多的库区类型为备货区（规模较大的仓库还会将备货区分为拣选区和仓储区，拣选区为日常出入库使用，仓储区作为拣选区的补货源。）货位本身没有类型的概念，它按照所属的库区、通道位置、层数和列数等属性确定唯一定位。货位的陈列依赖于货架类型，不同货架类型的层数、列数都不相同，常见的货架类型就是横梁式货架。每个货位陈列着实物商品，商品要包含基础的商品信息，如商品编码、名称、品类和规格等，食品类的商品还需要包括有效期情况。



除了这些基础的管理单位，还有一些特殊区域或管理单位，包括月台、工作台和容器等。月台也称为“进出货站台”，它是指与仓库相连的线路或进入到仓库内部的线路，以及线路与仓库的连接点。月台是物流园区货物的入口，也是货物的出口，是进出货的必经之地，简单地说是仓库出入库装卸的特殊区域。通常情况下，也会根据作业内容的不同将其划分为出库月台和入库月台，面积较大的仓库对月台划分会更为细致，比如收货暂存区域、发货区域和销退区域等。工作台主要是负责在作业流程中处理特殊工作的区域，如复核、打包和分播等。工作台和库区一样，可以按照划分承接相关的作业任务。



除了这两种特殊区域，还有一种管理单位也是在仓库中最常使用的，这就是容器。



容器，顾名思义，是负责存放货品的设备，但区别于货架，容器具有可移动的特性。原则上来说，仓库内的商品如果没有在货架上，那么一定是放置在某种容器中（当然容器此时也可能存在于某个特殊区域内）。在后续的作业流程中我们会详细讲解容器的使用状态变化。在仓库内常见的容器类型包括托盘、周转箱和拣货笼车。



按照上述区域情况，我们可以大致制作出一张仓库的整体平面结构图，上述的相关主要区域分布如图：

![image-20210227124132326](http://qiniu.hivan.me/picGo/20210227124132.png)



我们知道了仓库区域的职能和划分，在库内需要按照实际业务需要完成所有货品的管理。仓库管理员按照规定的流程将商品从一个库区（或库外）转移到另一个库区（或库外）的过程就是仓库作业流程。从库外转移到库内叫作入库流程，从库内转移到库外叫作出库流程，库房之间的转移叫作移库调拨流程，而库内的所有移动和管理叫作库内作业流程。库内的所有流程都是通过单据实现流转记录的，因此每一个流程都伴随着一个或者多个单据的处理。



### 入库

入库指仓库根据具体业务情况完成货品从仓外到仓内的上架过程。



入库的情况分为很多种，最常见的就是采购入库，此外还有销退入库和调拨入库等。



入库基础操作流程都是收货员将需要入库的货品进行收货登记，登记完成后的商品放入暂存区，然后由理货员将商品完成系统录入，系统会对录入后的商品进行上架安排，拣货员根据上架计划完成商品的上架工作。



要特别说明的是，仓库为了能够快速发货，提高库存周转率，有些时候也会采取越库的操作。越库的意思是将入库的商品不完成上架备货的操作而直接从收货暂存区进入出库暂存区，完成发货行为，在越库过程中，仓库更多的是作为一个中转站而没有使用其存储的属性。越库时，考虑到有些货物需要在出入库时完成对应，避免出错，这时候需要将出库批次和入库批次保持完全一致，不一致的则不允许出库。



首先讲述最常见的采购入库。采购入库指的是根据日常的采购计划完成采购行为，供货商根据采购单的情况将货品送至仓库并完成收货签收，然后将货品入库上架的过程。在采购完成后，供应商需要先将采购单中的商品信息回传给WMS并预约采购到库时间，WMS根据到库时间确认预约是否完成。

![image-20210227124214805](http://qiniu.hivan.me/picGo/20210227124214.png)



- 采购系统通过接口向WMS下发采购单预约信息。
- WMS接收采购单预约信息。如果采购单已预约，那么在预约表中更新对应的预约信息，并将预约成功信息回传采购系统；如果采购单未预约，那么在预约表中新增预约信息，并将预约成功信息回传采购系统。
- 采购系统通过接口向WMS取消预约，WMS接收取消信息，同时判定取消的采购单状态。如果采购单已开始收货或收货完成，则取消失败，WMS将失败信息回传采购系统；如果采购单未开始收货，则取消成功，WMS将取消成功信息回传采购系统。



预约成功以后，供应商需要根据预约时间将货品送到仓库。采购商品到库以后需要完成签到，签到以后的车辆会根据流量和月台情况安排进入相应的月台。当月台人数过多时，则需要等候排号，等待月台释放。

![image-20210227124226338](http://qiniu.hivan.me/picGo/20210227125906.png)



仓库签到员在WMS中查询采购单的预约信息。如果WMS中没有预约信息，此时判定仓库是否允许无预约收货，如果允许，则进入签到流程；如果不允许，签到员告知供应商未预约，供应商需按照预约流程完成预约后方能签到。WMS中有预约信息，则直接进入签到流程。



签到员根据实际到货明细和数量勾选预约明细，核对后修改到货数量。签到时需手工录入发货单号、司机、承运商、是否使用升降平台、车牌号、电话、送货包件数和送货数量等信息，确认后完成签到。WMS按照采购单+送货单维度生成收货单，采购单签到状态需回传外围系统。



签到员为收货单分配月台。如果有空余月台，则WMS推荐符合类型的月台编号并打印；如果没有空余月台，WMS打印排队号后，供应商排队等候。等有空闲月台后，签到员重新分配月台和打印。在分配月台的时候有两个分配原则。

- 要根据每个月台的使用情况平均分配，按照当日月台使用频次均衡每个月台的使用次数。
- 专属月台空闲时优先分配，比如移仓调拨、销退车辆优先进入对应专属月台，当采购入库有贵重品时，优先进入贵重品专属月台。



另外，在分配月台前要看下当前批次的商品是否存在一码多品的情况。所谓一码多品是指同一个条形码对应多个商品的情况，这类商品需要将条码信息打印出来，确保商品对应。还需要查看当前批次的商品是否存在新品情况，即不在当前商品库的情况，如果存在，需要将采购系统中的商品信息同步过来并录入WMS中。完成月台分配后，同样需要打印排队信息，等待安排进行卸货，分配月台后还需要将预检单打印完毕。

![image-20210227124238896](http://qiniu.hivan.me/picGo/20210227124238.png)



验收员首先对每车的到货包件进行到货登记和验收，并打印预拣单，扫描收货单号，扫描商品编码，选择商品等级后，输入质保期（启用）、收货数量，根据输入的信息，系统按照配置表推荐商品上架去向。验收员扫描容器编号，确定后即完成收货。此处扫描的容器编号需与容器内已有商品的上架去向一致。如果容器已装满，需要做“满箱”操作，满箱后WMS暂存区将增加库存，并以容器为单位生成一条上架任务，满箱后的容器不允许再收货。收货单完成收货后可在系统中打印收货凭证，验收员核对收货凭证和实物，若无差异，可对收货单进行“关单”操作。关单后收货信息将同步至采购单，采购单按实收明细回传到采购系统。



在设计整个流程时需要注意几个逻辑点。

- 不同收货任务去向不同，不允许使用同一个容器（装箱）。
- 同一个收货任务可以多人同时收，但同一商品只能一个人收。
- 同一采购订单只能有一条“未完成”收货任务。



按照上述流程采购商品，就完成收货的环节。商品放入容器后，会被推入待上架区域等待理货员整理上架，不过也有商品是不需要进入仓库上架的，这就是前面提到的越库流程。越库流程同采购流程在收货环节基本类似，一般是通过当前仓库进行中转到达目的仓库，因此当前仓库被称作“中转仓”，而目的仓库被称为“目的仓”。验收员对到货包件进行到货登记后，扫描收货单号，获取中转仓、目标仓信息，然后验收员需要将有标签收货的商品逐个扫描标签，无标签收货的则输入包裹数量。扫描完毕后，验收员将验收过的包裹放入容器，扫描容器进行关联。容器“满箱”操作后，生成越库发货任务。需要注意的是，越库验收只验收包裹数量和包裹ID，不验收商品明细，也不增加库存。



采购商品在完成验收以后进入待上架区，随后商品就进入上架流程，上架完成后的商品在商品系统中属于可售卖商品。在上架时我们需要使用RF设备进行操作，RF（RadioFrequency，简称“射频”）是一种技术，在仓储管理使用最多的就是RF枪。RF枪就是用来进行扫描的一种手持设备，主要通过设备自身带的激光头、红外头和自感应设备等来对条码或者专门的芯片进行识别。

![image-20210227124256891](http://qiniu.hivan.me/picGo/20210227124256.png)



上架任务有两种上架方式：整托上架和按商品明细上架。

- 整托上架以容器为上架单位，容器内的所有商品明细一次性上架到一个库位。操作方法如下。
- 扫描容器编号，WMS显示上架品数和总数，推荐上架去向。
- 扫描待上架库位，确认后完成上架，容器内商品的库存，从暂存区转移到拣选区或者备货区。
- 按商品明细上架是对容器内某个商品的部分或全部进行上架，操作方法如下。
- 扫描容器编号。
- 扫描商品编码。
- WMS显示可上架数量，推荐上架去向。
- 输入实际上架数量。
- 扫描待上架库位，确认后完成上架，容器内商品的库存从暂存区转移到拣选区或者存储区。



采购入库里面的上架流程属于通用流程，无论是哪种类型的入库都是一样的。我们来看销退入库是如何完成收货的。



电商平台日常会产生很多的退换货订单，这些退回的商品都需要通过相关人员返回仓库。销退的方式有很多种，最常见的就是用户在前台申请退货后，由快递人员上门取件，取件后关联快递信息到订单上，并由快递人员带回商品。当然也会出现邮寄的情况，不过这种情况较少。见下表：



**销退入库可能涉及的单据**

| 单据名称   | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| 邮寄退货单 | 在订单系统中生成                                             |
| 邮寄换货单 | 在订单系统中生成                                             |
| 上门退货单 | 在订单系统中生成                                             |
| 上门换货单 | 在订单系统中生成                                             |
| 原单       | 在订单系统中生成的正常订单                                   |
| 母单       | 订单生产过程中，同收货人同地址订单可以合并为一个母单一起出库，母单由WMS生成 |
| 销退单     | WMS生成的销退单，一个销退指令对应一个销退单号                |



用户提出退货申请或者拒收后，订单系统将所有退货信息同步给WMS，同时TMS也会将退货订单按照发货时间生成退货批次，发送给WMS。货品被快递人员带回时，收货员会接收销退包裹并拆包件，扫描包件内商品，核对商品数量并区分商品为良品、残品。将不可销退的商品做线下记录，联系客服做线下异常处理。收货员在验收商品的同时扫描容器，按照商品去向将其放到不同的格口中。销退完成后，将满箱的容器做“满箱”操作并生成上架任务。

![image-20210227124315144](http://qiniu.hivan.me/picGo/20210227124315.png)



移库调拨的入库流程大致与上述两种情况相同。



由此可以看出，在入库时主要经历几个子流程。

- 收货验收流程：完成收货，接收即将入库的商品。
- 容器选择流程：录入商品信息后选择容器，根据录入信息，系统提供推荐上架位。
- 上架流程：完成上架的过程。



### 出库

与入库相对应的就是出库操作，日常最多的出库行为就是订单出库，除此之外还有供应商退货和调拨出库。重点讲订单出库的部分，其他的出库在流程上与订单出库类似。出库过程流转的单据叫作出库单。



出库流程包括如下几个节点。

- 制订发货计划：按照订单情况制订当日发货计划。
- 生成拣选汇总单和拣选单：根据发货数量和商品情况，汇总制订当前拣选批次汇总单和分区拣选明细单。
- 实物拣选：根据实际情况进行拣选，拣选后商品在架库存发生变化。
- 分播：针对订单维度对拣选的商品进行分拣，目前比较常用的是播种墙模式，因此这个环节也叫分播。
- 质检、打包：对按订单维度拣选出来的商品进行质检、打包。
- 出库：包裹与分配的司机进行交接，完成订单出库。



在仓库内每日发货都会明确当日截单时间，截单后进入的订单不会在当日完成发货。截单前产生的订单会进行商品数量及情况统计，生成对应的拣选单。由于拣选的工作量很大，为了能够提高效率，往往会将订单汇总后，按照商品维度进行拣选，也叫作汇单。对于大型的电商平台来说，仓库往往面积很大，具备多个大区，所有汇总的拣选单也会根据分区情况生成分区拣选单。这里需要说明的是，不是所有的订单都需要汇总后进行分拣，有一些订单购买的品类单一且数量较大，可以设立单独渠道进行一单一品的单独分拣，以此提高效率。需要根据实际情况分配分拣员，实际情况包括但不限于分拣商品区域位置、分拣商品数量、使用容器承载量等。



总拣完毕后需要将所有的商品推入播种区，播种区中的主要设备叫作播种墙，它一般由N×N的格子构成，每个格子存放一个订单的商品。分拣员将总拣完毕的商品按照订单需求分配到每一个格子里面就叫播种，这个形式有点像早年间的邮递员整理分类信件。而一单一品的商品则不需要通过播种墙的方式进行分拣，汇总的商品拣出来后被上架到特定的拣货区，由员工按单拣货，这个适合订单适量、品种少的订单。



分拣完的订单需要放入复核台进行复验，确保商品数量、种类与订单信息匹配一致。复验完毕后进行打包，打包时会将之前打印的物流单信息贴在包装上，同时会在箱体内附一份商品清单，用于用户收货后的核对。当用户需要纸质发票时，箱内也会附带发票。打包好的包裹信息会回传给订单和TMS系统，TMS根据运单号和包裹信息安排快递人员收货、装车。完成装车后，仓内出库单变为“完成”状态。



### 移库调拨

移库调拨同属于将货品从原有位置转移到目标位置，不同的是，移库指的是同一仓库中的库维人员进行实物货位、库存形态间移动的处理过程，它与盘点、补货等同属在库作业；而调拨指的是仓与仓之间完成实物货位、库存的迁移处理过程，它的形式需要通过上架、下架、运输等多个环节构成。来看一下这两种情况下的业务场景和流程。



移库管理一般提供人工移库和计划移库两种作业模式。人工移库支持3种作业方式：按商品移库、按品项移库、按货位移库。

- 按商品移库：是以商品为单位移动货位上已上架的商品，并转移到目标货位或是移库容器。
- 按品项移库：是以品项为单位移动货位上已上架的商品，这里的品项可以理解为SKU。例如，经典鱼奶茶可以理解为是一个商品，而经典鱼奶茶（热）则可以理解为是一个品项。
- 按货位移库：将当前货位上的所有商品转移到目标位置或容器。



人工移库指人工按照要求执行的移库作业，除了人工操作，日常工作中系统也会根据情况自动生成计划移库作业。计划移库的任务根据业务设定执行任务计划，计划中会包括商品原位置的下架操作和目标位置的上架操作。人工移库则不一定是完整的上、下架操作。人工移库多使用RF，而计划移库多通过WMS操作执行。移库计划有以下3种作业场景。

- Band异位库存整理移库计划，其目的是提高仓储ABC分类（ActivityBasedClassification）存放准确率。这里的Band指的是按照ABC分类法分类后商品对应的分类等级。
- 预拣配区库存整理、JIT（JustinTime，准时）拣选区库存整理移库计划，其目的是可销售库存更新实时化。
- 优先出库区库存整理移库计划，它在满足生产要求前提下尽可能集中存放。



另外特别说明一下，存储区移库下架强制性按箱包规格下架，以避免出现零散货品无法核对的情况。



移库时需要根据操作生成对应的单据，包括上架单和下架单。上架和下架时单据状态也会随着情况变化，单据同时包括主单和商品明细两部分。首先我们先看一下下架单的状态变化情况：



**下架单状态变化**

| 状态     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 未开始   | 主单：生成时更新。 明细：生成时更新                          |
| 分配中   | 主单：PC任务分配、重分配，或RF主动在领取“未开始”任务时更新。 明细：无 当前操作只在RF操作时更新状态 |
| 下架中   | 主单：确认绑定“容器”后更新 明细：无                          |
| 下架完成 | 主单：明细全部为“下架完成”，主单更新为“下架完成”。 明细：单品下架确认，更新“下架完成” |





**上架单状态变化**

| 状态     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 未开始   | 主单：生成时更新。 明细：生成时更新                          |
| 上架中   | 主单：任务领取、操作移库上架时更新。 明细：商品明细上架确认时，如果0<=已上架数量<计划上架数量，且原状态为 “未开始”，则更新明细状态为“上架中”。 当前操作只在RF操作时更新状态 |
| 作业审核 | 主单：如果任意一个上架明细单的状态为“作业审核”，则上架任务主单状态为“作 业审核”。 明细： 记录更新“上架单”商品中所有“已上架数量v计划上架数量”的上架商品的 明细； 非“上架单”的上架明细：“未开始、上架中”的上架明细状态更新为“作业 审核” |
| 上架完成 | 主单：明细全部为“上架完成”，主单更新为“上架完成”。 明细： 1. “已上架数量=计划上架数量”单品上架确认，自动更新为“上架完成”; 上架差异确认时更新为“上架完成”; 回库上架单中“已上架数量<计划上架数量”且多货录入商品有差异、无其他类型录入商品或其他类型录入商品无差异的上架明细整单完成时，更新“上架 完成”(即作业审核状态中明细更新的第一条) |





每次移库完成，最终操作都包含上架和下架两项闭环。移库是为了调整仓库内的陈列情况，提高使用效率和缩短周转时间。而调拨则是为了调度不同仓库间的商品库存。调拨发起前需要先根据各仓库的情况生成调拨计划，按照调拨计划，WMS根据调拨商品信息生成调拨单任务。调拨任务包括有订单调拨和无订单调拨两种，前者是用户订单产生的调拨行为，也就是我们俗称的“订单移仓”，而后者就是仓库之间的普通调拨。调拨任务主要是下架任务，下架流程同出库下架相似。出库以后完成调拨配送工作，在配送过程中需要将商品库存调拨的部分转为在途库存并告知库存系统。

![image-20210227124609532](http://qiniu.hivan.me/picGo/20210227124609.png)



在调拨过程中，商品的可售库存会随着调拨情况的变化而发生变化，这个变化同样也会出现在移库时，只不过移库的持续时间相对较短。当调拨商品执行完下架操作后，前台库存也需要随之减少，并且这部分调拨商品库存应该处于冻结状态。调拨商品出库后则需要将该库存数加入在途库存中。入库时库存的变化同采购、销退一样。调拨过程中也会产生相应的单据，同样，我们来看一下调拨过程中的相关单据信息，见下表：





| 单据类型   | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| 调拨单     | 为了满足库存平衡，对仓与仓（含FDC）之间的库存生成库存调整的无订单调拨 单和日常配送单，对由订单驱动的商品仓与仓之间的库存生成库存调整的有订单 调拨单。调拨单类型分为两种：有订单调拨单、无订单调拨单 |
| 调拨波次单 | 一个或多个调拨单组建一个调拨波次                             |
| 调拨下架单 | 由调拨单按照一定规则生成的、用于仓库执行拣选任务的依据       |
| 包件号     | 用来记录实物包裹与商品明细的绑定关系                         |
| 发运单     | 根据包件和运输车辆生成发运单，用来记录承运商一次交接的所有包件信息 |
| 调拨差异单 | 目标仓反馈的在收货过程中出现的差异数据                       |



单据之间也有对应的规则：

- 调拨单与调拨波次是多对一的关系；
- 调拨波次与调拨下架单是一对多的关系；
- 调拨单与调拨下架单是多对多的关系；
- 调拨单与包件是多对多的关系；
- 调拨单与发运单是多对一的关系；
- 发运单与包件是一对多的关系；
- 一个调拨单可以对应一个或两个调拨差异单，一个调拨差异单只能对应一个调拨单。



调拨单作为各个单据的链接枢纽，记录整个调拨过程的变化。我们也来看一下调拨单状态机的情况：



**调拨单状态变化**

| 调拨单状态 | 备注                                                         | 信息归属        |
| ---------- | ------------------------------------------------------------ | --------------- |
| 未开始     | 接口表调拔単导入WMS时的初始化状态。 补货任务完成之后，释放调拨单,将调拨单状态从“挂 起”更新为“未开始” | 来源仓          |
| 挂起       | 组建波次定位时.需要补货的调拨单状态由“未开始”更新 为“挂起”.并注明挂起原因 | 来源仓          |
| 波次组建   | 库存定位完成后更新的状态                                     | 来源仓          |
| 下架完成   | 调拨单对应的所有下架任务完成时,更新调拨单状态为“下架完成”    | 来源仓          |
| 分播完成   | 调拨単对应的所冇分播任务完成时,更新调拨单状态为“分播完成“    | 来源仓          |
| 质检完成   | 调拨单对应的所有质检任务完成时.更新调拨单状态为“质检完成”    | 来源仓          |
| 包件出库中 | 调拨单下的第一个包件与发运单绑定的时候.更新调拔单状态为“包件出库中” | 在途信息/来源仓 |
| 在途       | 调拨单对应的所有包件状态为“包件出库”时.更新调拨单状态为“在途” | 在途信息/来源仓 |
| 到货       | 调拨入：目标仓调拨单对应的第一个包件更新“包件到货” 状态时    | 在途信息/来源仓 |
| 验收中     | 调拔入：调拨单中第一个包件验收开始                           | 目标仓          |
| 入库       | 调拨入：所有包件完成验收                                     | 目标仓          |
| 关闭       | 调拨入：手工关单或系统自动关单.此时调拨单写入在途信息        | 在途信息/目标仓 |
| 完结       | (1) 波次组建时，针对“未开始”和“挂起”状态的调拨单， 执行手工完结.则将调拨単的状态由“未开始”更新为“完结”； (2) 定位时全部报缺的,直接更新为“完结”； (3) 调拔氓质检数虽全部为0时,直接更新为“完结” | 来源仓          |



### 盘点

库存盘点是每个仓库主要的日常操作流程之一。



盘点的目的是核对当前仓库库存的实际情况，确定仓库内商品的损益情况。盘点行为分为计划盘点和随到随盘两种模式。计划盘点多用于大规模区域盘点，比如年底的集中盘点；而随到随盘可用于日常小范围盘点或抽查。



同其他流程相同，它们都会制订盘点计划，生成盘点单，将盘点单分配给对应的仓库盘点人员。盘点人员通过手持的PDA获取需要盘点的信息，盘点单中除了记录商品的基本信息，还需要显示盘点前的理论库存，盘点后通过人工录入实际库存来计算它们之间的货损差值。盘点前的库存数据应该获取实时数据，以避免在盘点过程中出现货品分拣、下架等行为导致的库存数量不符。盘点效期商品时需要同步盘点效期情况，遇到临期或者过期商品，需要执行商品下架流程并申请报废。



由于盘点的留存和状态机较为简单也同其他流程类似，这里就不单独讲解了，具体可参照前面的其他流程图。



### 补货

补货是一种取决于仓库内部情况而进行的行为，是仓储管理里必不可少的一环。较大的仓库通常将备货区分为存储区和拣选区。存储区主要作为拣选区的货品源头，补货指的是将货品从存储区补充获取到拣选区的过程，而小型仓库或者中转仓可以不需要进行此项操作。



补货方式取决于库内的实际情况，一般分为整箱补货、托盘补货和上架/下架补货等方式。整箱补货这种补货方式由操作员到货架存储区取货箱，用容器（一般是手推车）推至拣选区，较适合于体积小且少量多样出货的货品。托盘补货方式是以托盘为单位进行补货，这种补货方式适合于体积大或出货量多的货品。上架下架补货方式就是将同一货架上的中、下层作为动管区，上层作为存管区，而进货时则将动管区放不下的多余货箱放到上层存管区，宜家的仓库就属于这种结构，这种补货方式适合于体积不大、存货量不高且多为中小量出货的货物。



补货的触发机制是：针对每个商品的库位的库存数量设置阈值，库存在阈值以下则触发预警，提醒补货。仓库管理人员可根据补货预警制订补货计划，完成补货行为。补货也可以通过WMS系统的算法触发，核心的指标是仓库每日的库存出货量。



### WMS与其他系统的关系

WMS的作用是管理仓库，因此在业务上与仓库有来往的环节或者系统都属于WMS的上下游系统。它在订单上需要跟订单系统、TMS系统和库存系统等进行交互，完成订单履约，在采购方面需要跟采购系统交互，完成采购补货：

![image-20210227124739634](http://qiniu.hivan.me/picGo/20210227124739.png)

## 系统逻辑

采购入库主要在供应链系统，也就是后台系统内进行，涉及的主要是WMS和采购系统。当完成采购商品入库、上架后，商品的在库库存会累加本次采购库存，在库库存发生变化后需要同步给商品系统更新在线库存，一般情况下这个动作应该是实时进行的。由于采购是按照批次进行的，因此同一个商品对应每个批次的采购价格可能不完全相同，一般是仓库设定一个出库定价给商品系统，以此定价作为该商品的采购价，这个定价初期可以人为确定，或者通过系统将一段时间内的采购价加权平均作为最终定价。

![image-20210227124803373](http://qiniu.hivan.me/picGo/20210227124803.png)



采购入库流程中实体之间的关系如何，明确各个角色和实体之间的关系，有助于后面对结构和平台逻辑的设计提供支撑。



采购入库主要涉及的实体是仓库和商品，根据流转的不同阶段，我们把商品分为采购商品和在库商品，而承载商品的流转单据包括采购单和入库单。



一个单据内包含同一批次的多个商品，而每次流转的单据是一一对应的，比如入库单和采购单就是一一对应的。从角色上来看，采购和供应商通过采购合同建立关联，合同所属也是一一对应的。



按照不同批次采购会下采购单给供应商，采购单分别与采购、供应商是多对一的关系。如下È-R图：

![image-20210227124811567](http://qiniu.hivan.me/picGo/20210227125933.png)



## 系统交互情况

依照本期的业务诉求实现，商品系统与各系统间的交互情况

![image-20210227130103525](http://qiniu.hivan.me/picGo/20210227130103.png)



搭建初期平台时系统还不是那么多，因此对于商品的管理更多的是将其集中在一起进行统一操作，这里包括库存和价格的设置。



未来，随着业务的扩大，后续这两部分可以分别成为一个单独的系统进行运营。通过采购系统和WMS将商品基本信息传送给商品系统，作为线上售卖的商品池。商品专员在商品系统中选择待上架商品，完善所有信息（在售库存、销售价和图片等），并进行上架操作。



上架后的商品会从商品系统同步给前台系统。门店或用户可在客户端选择并下单购买，交易系统和订单系统则会通过商品ID从商品系统中提取完整商品信息进行保存和处理。



我们用E-R图来表达实体之间的逻辑关系，看一下数据交互是如何对应处理的。



商品管理的实体主要是商品本身，我们定义在线售卖的商品为在线商品，而定义仓库里面存放的实体货物为在库商品。每一种在线商品对应一个仓库内的在库商品，而不同的商品又可能存放在不同的仓库中，因此仓库和在库商品是多对多的关系。



从使用角色的角度，我们来看一下实体间的关系：

![image-20210227130117023](http://qiniu.hivan.me/picGo/20210227130117.png)



每个商品专员会负责多个或者所有商品的在线上、下架处理，而每个库管在同一个仓库中也是负责多个商品的实物管理，商品专员和库管之间则没有必然的联系。