# 提高风险承载能力



**风控系统**



电商平台本身是一个以交易为核心的平台，所有的行为都是紧密围绕交易进行的。而自古以来所有的交易都是在诚信公正的基础上完成的，任何一方的欺诈行为都会导致交易的失败或者交易方的利益受损，这种情况不是我们希望看到的，更不是用户希望看到的。为了保证交易的安全及交易双方的安全，我们需要进行管控，对所有可能存在风险及问题的环节进行有效的监督和处理，这就是风控系统。

“风控”全称叫作“风险控制”，其核心的目的就是预防所有可能对平台、用户和商家造成非正常交易以外损失的风险。风控是一个覆盖面很广的概念，从用户开始登录选品到支付完成，直到最后商家送货完成后进行结款，所有的环节都属于风控管理的范畴。因此风控系统不是一个传统意义上的系统，它的边界十分模糊且它存在于任何一个相关系统的内部。接下来我们看看这个隐藏在所有系统背后的风控体系是如何运转的。



## 风控范围

虽然风控系统是融合在所有其他系统之内的，但严格意义上来看，它还是有它的“管辖”范围的。风控是为了控制、预防风险，因此所有涉及风险的环节都应有风控系统的存在，其中包括以下几个部分。

- 用户信息：用户在平台中的所有相关信息，包括账号、账户等
- 交易信息：用户在平台进行的交易信息，包括订单信息、支付信息和地址等
- 全平台攻击：对平台进行非常规行为，从而造成破坏和损失

这些行为或者信息本身是存在于其他系统之中的，比如用户信息属于用户体系，订单信息属于订单系统，支付信息属于支付系统等。而当对这些信息进行处理和操作时都需要优先进入风控，由风控进行风险评估判断，不同的风控内容会有不同的判断标准。

## 风控规则

风控系统最重要的就是规则，规则决定是否异常。在讲规则之前我们先来说一下风险等级的概念。风险等级主要是输出给对外业务系统进行风险判断使用的。业务系统一般会按照风险等级的建议行为执行操作。一般风险等级会分为：

- 无风险，不需要拦截
- 低危，建议不拦截
- 中危，建议二次认证
- 高危，建议拦截
- 极其危险，必须拦截



风控规则抽象来看主要是以下几个维度：

- 时间：事件发生时间、评估风险的时间区间等
- 地点：区域维度、店面维度和订单维度等
- 人物：用户维度、家维度和物流配送员维度等
- 起因：触发条件，如连续3次以上或黑名单用户
- 经过：执行风控规则，按照风控规则判断风险等级情况及给出处理建议
- 结果：风险等级或处理建议结果输出



我们可以看到，风控规则的本质就是总结可能触发异常的场景进行描述，通过系统维度进行定义和归纳。其中时间、地点和人物是基础数据，风控系统通过外部系统获取这些信息，而起因、经过和结果等就是对数据执行具体风控规则的规定，如图：

![image-20210228131742943](http://qiniu.hivan.me/picGo/20210228131742.png)





这里举几个简单的风控规则例子，来看一下风控规则在实际设定时包含什么信息，见下表『**风控规则设定信息』**。

**风控规则设定信息**

| **风控规则**                                                 | **应用场景**     | **参数变量**                                                 | **处理建议**                 |
| ------------------------------------------------------------ | ---------------- | ------------------------------------------------------------ | ---------------------------- |
| 收货地址少于N个字符                                          | 收货地址虚假     | 收货地址: order_address  字符数：N                           | 虚假地址-下单拒绝/取消       |
| 同一用户时间区间内连续下单N单促销商品                        | 刷单             | 用户: user_id  下单时间：order_time  下单数：N               | 刷单-下单拒绝/取消           |
| 同一个设备同一门店在一定时间段内连续下单N单                  | 刷销量/刷排行    | 设备： device_id  店铺：shop_id  下单数： N  下单时间：order_time | 刷销量-商家\|门店警告/黑名单 |
| 同一个设备不同店铺连续下单N单，商品单价金额较低，且设备曾经登录过店铺商家端 | 刷销量，多人互刷 | 设备: device_id 店铺：shop_id 商家信息：seller_id 商品信息: sku_id、sale_price 下单数：N | 刷销量-商家警告/黑名单       |



在定义风控规则的时候需要通过多个维度进行设定，设定的原则是将非法的行为和人群特征与正常的行为和人群区分开来，通过各种维度的信息将其进行分类。如果风控规则中包含的信息不全，则需要要求上游系统补充完善提供的信息。上述的风控规则更多的是具体某一个场景下的风控判断，如果涉及更复杂的维度和计算，则需要针对风控要求进行建模。



## 风控处理方案

风控的本质就是对数据、行为进行保护和监管，因此风控系统的处理方法也是针对这两个方面的。在数据方面我们需要对所有的内部数据进行加密处理，数据库中的敏感信息不能使用明文保存，其中，敏感信息包括用户的姓名、用户名、密码、身份证、手机号和地址等。内部平台的所有信息查询界面需要增加水印，水印为登录员工的姓名和工号，防止通过内部渠道产生数据泄露。同时要对数据进行脱敏显示，所谓脱敏显示，即对涉及的敏感信息都采用隐藏部分内容的方式进行处理，比如“`张三”可显示为“张*`”，手机号“`13511111111`”可显示为“`1351111`”。在传输过程中也同样需要进行加密，防止数据被截取。

按照上面划分的几个范围来看，风控管理的行为场景包括以下几种。

- 用户信息处理：主要对用户账号和账户的安全进行监管，包括恶意登录/注册、撞库和盗号等
- 交易行为处理：主要对所有可能出现异常的交易行为进行监控，也叫反欺诈，包括刷补贴、刷排行、虚假履约、“薅羊毛”和逻辑漏洞等
- 恶意攻击：机器人爬虫抓取、钓鱼短信邮件和短信轰炸等

所有的恶意行为都是利用平台的漏洞和问题，通过人或者机器进行利益的非正常获取。风控系统就是通过隔离、中断和预防的方式阻止所有恶意行为的进行。目前，随着技术水平的提高，许多恶意行为通过系统或者脚本的方式快速、大批量地进行，但所有的系统脚本都需要按照既定的规则连续运行。风控系统通过终止它们的连续行为，可以有效地阻止恶意行为。风控的处理包括实时处理和延时处理两种方式，一般交易类的都采用实时处理的方式，而恶意用户的判别等一般都采用延时处理。

这里以登录为例来说明一下如何进行风控对抗升级。当黑客希望获取平台用户信息时，主要的策略就是通过不断地登录尝试密码进行暴力破解，平台通过增加数字验证码的方式阻止终端连续登录，可由于数字验证码位数较少且排列组合数量有限，黑客依然可以通过技术手段破解。随着后续发展，平台增加了图形验证码、滑块验证码直至语音短信等方式进行验证，再后来，由于黑客不停变化登录方式，如更换IP地址等，这就需要通过监控异常的登录行为对异常用户或者异常登录的IP地址进行隔离。由此我们可以看到，登录行为可以通过由简到繁、由单一到多种方式混合进行综合处理判断，尽可能地杜绝恶意行为的攻击，安全处理方式见表『**安全处理方式』**。

**安全处理方式**

| **处理方式** | **说明**                                                     | **安全性** |
| ------------ | ------------------------------------------------------------ | ---------- |
| 图形验证码   | 最常见验证方式，容易被破解                                   | 低         |
| 短信验证码   | 平台接入第三方机构，成本低，价格每条在0.1 ~ 0.5 元之间       | 低         |
| 语音验证码   | 安全性较高，介入方式成本高，价格在1~2.5元之间                | 高         |
| 用户封禁     | 对异常用户行为进行封号，误杀率相对较低                       | 高         |
| IP封禁       | 对异常登录的IP地址进行封禁，这对于频繁更换地址的黑客见效快，但误杀率较高 | 高         |

## 风控处理流程

风控的处理流程同其他系统也有很大区别。风控系统本身不产生数据，而主要是相关规则的设定和判断。所有进入风控系统的数据都会根据不同的规则进行归类、处理和判断，而输出的结果主要是风险评定的结论。风控系统提供的结论会被其他业务系统用来辅助业务流程的处理和操作，如图：

![image-20210228131844402](http://qiniu.hivan.me/picGo/20210228131844.png)



除此之外，风控系统还会对大量的行为数据（如浏览、交易等）进行监控分析，从中发现恶意行为并进行及时的处理。这里针对主要流程的接入情况做一下说明，电商的主要流程主要包括登录、下单、支付和优惠券领取等。

首先说一下登录环节的风控处理流程。登录时用户进入第一个环节，从购物车往后的购买流程都需要用户在登录的状态进行操作，因此登录环节起到阻隔陌生访问、验证用户身份的作用，因为很多黑客会不断尝试撞库以获取用户信息，也有黑客通过暴力破解获取用户登录密码，从而盗取用户账号。风控系统在判断前需要通过用户端获取到当前登录访客的相关信息，包括登录用户信息、设备信息和时间信息等。

![image-20210228131851854](http://qiniu.hivan.me/picGo/20210228131851.png)



如上图所示，将用户的登录信息输入风控系统进行规则判断，如果判定为高危，则需要升级登录验证等级，使用语音或短信方式验证；而如果用户是被风控标记的用户，则拒绝用户登录，出现过异常登录行为的用户则会被冻结用户资产，被冻结的用户必须经过线下人工核实后方可以解冻。

风控评定等级为中等危险，则需要提示用户通过滑块或图形验证码进行二次登录。中等危险的登录评定不会强制打断登录过程，而是增加二次验证以确保用户身份。验证通过后，系统根据用户输入的信息进行用户登录信息的核准，如用户登录信息输入无误则会完成登录，输入错误则会返回登录界面。所有的登录信息，无论成功还是失败，都需要将登录行为数据同步到风控系统，用于后续的行为分析评估。

如果风控系统评估等级为低危以下，则按照正常的登录流程进行登录验证。

短信验证的机制与密码验证的机制相似，在短信输入完毕后同样需要将信息传输给风控系统进行评估，如果评估为中危，则进入滑块模式进行验证。需要说明的是，短信验证一般不评估为高危，因为短信相对于用户名/密码来说伪造成本高，它主要是通过注册大量虚拟号进行攻击，可以通过滑块模式来进行中断。

接下来我们看一下风控具体是如何在下单流程中发挥作用的。下单环节是电商平台的核心流程之一，下单过程除了生成订单以外还要完成支付。许多恶意的黑客、商家及门店为了套取平台补贴或者对数据进行作弊（如刷榜、刷信用度等），会通过下单进行恶意消费，他们注册大量的虚拟账号，通过脚本短时间内大批量下单，套取促销或者红包类的商品差值。下单时风控需要获取的信息主要包括订单信息、用户信息、地址信息、商品信息、商品金额、促销信息、优惠券信息、下单时间和支付信息等。

风控的处理一般在下单和支付两个环节进行。之所以会分为两个环节进行管控，是因为恶意刷单的订单量较大，按照风控等级逐级筛选过滤有助于缓解服务器的压力。同时，为保证用户体验，往往会在风控接口超时的情况下默认下单为正常单，两级处理可以加强对一级遗漏订单的保护。

在下单环节和支付环节处理时，风控会根据订单提供的信息进行风险等级判定，判定等级如果达到中断的等级，则业务系统会根据风控结果进行处理，对于异常的用户或者订单进行退单或者拒绝的提示，如下图：

![image-20210228131904079](http://qiniu.hivan.me/picGo/20210228131904.png)



优惠券领取也是很容易出现盗刷的环节。为了保证优惠券能够最大限度地拉新、促活，同时不会出现补贴金额被大量套现的问题，风控的接入是非常有必要的，流程如图：

![image-20210228131913040](http://qiniu.hivan.me/picGo/20210228131913.png)



当风控判断用户有刷单嫌疑的时候，可以拒绝发放优惠券或将优惠力度调整在合理范围内。调整力度的方式包括提高领取门槛、降低优惠金额。

需要提供给风控系统判断的信息包括用户信息、设备信息、优惠券发放信息、优惠券金额、优惠券分享信息和渠道信息等。风控系统根据提供的信息进行优惠券领取前的风控判断，如果判断异常则拒绝发放优惠券，并提示用户领取失败及其原因；如果风控系统核准可以发放优惠券，则会根据风控规则修正金额并通知营销系统进行优惠券生成。生成后的优惠券会发放到用户的账户中，创建成功的数据会同步到风控系统中，用于领取后的监控判断。